const express = require("express");
const cors = require("cors");
const multer = require("multer");

const app = express();
const PORT = 5000;

// allow frontend running at port 3000
app.use(
  cors({
    origin: "http://localhost:3000",
  })
);

app.use(express.json());

// Multer: Store uploaded files in memory
const upload = multer({
  storage: multer.memoryStorage(),
  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB
});

// Test route (you can check if server is alive)
app.get("/", (req, res) => {
  res.send("KYC backend is running âœ…");
});

// Upload endpoint
app.post("/api/kyc/upload", upload.single("aadhaar"), (req, res) => {
  try {
    if (!req.file) {
      return res.status(400).json({
        success: false,
        error: "No file uploaded",
      });
    }

    console.log("Received file:", req.file.originalname);

    // Dummy extracted data (replace with real ML later)
    const extractedDetails = {
      name: "Ishan Joshi",
      aadhaarNumber: "1234 5678 9012",
      dob: "15/07/2003",
      gender: "Male",
      fatherName: "X.....X Joshi",
      address: "House No. 12, Sector 9, New Delhi, India - 110001",
    };

    return res.json({
      success: true,
      message: "Document processed successfully",
      data: extractedDetails,
    });
  } catch (err) {
    console.error("Error in /api/kyc/upload:", err);
    return res.status(500).json({
      success: false,
      error: "Server error",
    });
  }
});

app.listen(PORT, () => {
  console.log(`KYC backend running at http://localhost:${PORT}`);
});

